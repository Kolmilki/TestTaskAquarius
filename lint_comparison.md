# **Этап 1**
# Сравнение логических линтеров для **Python**
В сравнении участвует три линтера, которые могут проверять логическую составляющую кода:
* **Pylint** - анализатор кода с широкой настройкой. Способен проверить не только логическую составляющую кода, но и стилистическую
* **PyFlakes** - пакет, также включенный в Flake 8, проверяет логику кода в источнике, не импортируя сам код
* **Ruff** - очень быстрый линтер. По заявлению создателей хорошо работает в связке с Black и Flake 8.  

А также linter, который по сути является обьединение трех других разнонаправленных линтеров, один из которых упомянут ранее:
* **Flake8** - обьединение нескольких линтеров, а также плагинов на них в один универсальный инструмент.

*Основная часть проекта, на котором производилось тестирование состоит из 217 строчек. Часть тестирования из 149 строк. Суммарно
366 строк.*

---
## Гибкость настройки
Гибкость настройки позволяет не распылять внимание на вывод ненужных ошибок, а также настроить линтер на особенности именно вашей
разработки.
### **PyLint**
Классический линтер для проверки логики и стиля написанного кода. Обладает очень широкой настройкой конфигурации. 
Это позволяет настроить его под любые задачи. Например настроить его на игнорирование определенных ошибок, модулей, файлов
или директорий.  
```commandline
usage: pylint [options]
```
### **PyFlakes**
Pyflakes является частью пакета Flake 8, где отвечает за определение ошибок в логике кода. Возможно из-за того, что данный
линтер является лишь пакетом куда большего проекта настройка его конфигурации скудна и ни чем примечательным похвастаться
не может. 
```commandline
usage: pyflakes [-h] [-V] [path]
```
### **Ruff**
Ruff легко настраивается под нужные действия. Сам линтер можно настроить с помощью *pyproject.toml*, *ruff.toml* или 
*.ruff.toml*.
```commandline
usage: ruff [OPTIONS] <COMMAND>
```
### **Flake8**  
Flake8 имеет большое количество настроек разного рода. Это позволяет форматировать код с удобством: можно вести список
не отслеживаемых ошибок и дополнять его, можно игнорировать определенные строки, можно вывести полученные ошибки в отдельный файл.
Среди настроек приятных глазу есть даже выбор цвета выводимого текста. Кроме прочего можно также рассмотреть работу
линтера в бенчмарке ```--benchmark``` и составить json справку для баг репорта ```--bug-report```.
```commandline
usage: flake8 [options] file file ...
```
---

## Время исполнения
Время исполнения проверки играет важную роль в больших проектах. Для сравнения использовалась консольная команда "time".
```commandline
time ptlint TestTaskAquarius/

time pyflakes TestTaskAquarius/

time ruff check TestTaskAquarius/
```
### **PyLint**
Линтер оказался самым медленным и проверил весь проект за 1.809 секунды. в сравнении даже с третьим местом это 
очень заметное отставание
> real    0m1,809s  
> user    0m1,758s  
> sys     0m0,050s  

### **Flake8**
Тройку лидеров замыкает flake8. На деле с найденным количеством ошибок результат у линтера неплохой. Отдельный от связки
пакет PyFlakes, естественно, отработал быстрее.
>real    0m0,100s  
>user    0m0,084s  
>sys     0m0,015s  

### **PyFlakes**
На втором месте PyFlakes c результатом 0.061 секунда.
> real    0m0,061s  
> user    0m0,052s  
> sys     0m0,009s

### **Ruff**
Самым быстрым оказался Ruff, который проверил весь проект всего за 0.049 секунды. Что подтверждает его претензии на звание самого 
быстрого линтера.
> real    0m0,049s  
> user    0m0,011s  
> sys     0m0,021s
---

## **Ценность работы linter**
И всё еще самым ценным, что может предложить линтер является отчет о возможных ошибках, конфликтах, помехах в работе и обо
всем прочем, чего программист мог не увидеть.

### **PyFlakes**
Слабейшим линтером в плане поиска логических ошибок оказался Pyflakes. В основной директории проекта он не смог найти ни 
одной ошибки. Нашел только в директории для тестирования - переопределение фикстуры и не использованный импорт. Никакой 
полезной информации он также не выдает. Только пишет где была найдена та или иная проблема.

### **Ruff**
Ruff оказался куда интереснее. Он нашел девять ошибок. Среди этих ошибок есть и не использованный импорт, и переопределение 
фикстуры. Странным оказалось то, что свою ошибку о не использованном импорте он забыл, и далее не раз написал, что импорт 
переопределяется несколько раз. Также Ruff нашел ошибку ```"Multiple statements on one line (colon)"``` . Бонусом линтер
написал, что может исправить четыре из девяти ошибок если прописать команду. 

### **Flake8**
Найдена 51 ошибка! Стоп. Ценных не так много. Просто линтер также проверяет стилистическое оформление кода. Он жалуется на
слишком длинные строки - не более 79 символов по умолчанию. Из куда более интересных ошибок здесь неиспользованные импорты,
множественное обьявленние переменной в строке и **переобьявление неиспользованного импорта**. По сути это одна ошибка, которую
другие линтеры ошибочно интерпретировали как две: обьявление неиспользованного импорта и его переопредление. Формулировку 
Flake8 куда проще осмыслить.

### **PyLint**
Самым сильным в поиске алгоритмических ошибок линтером оказался PyLint. Кроме проблем указанных двумя конкурентами были
также найдены уникальные ошибки, влияющие на работу кода. 

*Среди этих ошибок:*
+ Невозможность импорта из других модулей
+ Не нужный вызов else
+ Не закрытый файл
+ Переопределение имени из другой области
+ Неправильное определение константы

Кроме того. При чтении уникальных логических ошибок в перемешку со стилистическими нет никаких проблем для их анализа.
PyLint помечает разные типы ошибок разными буквами, а также нумерует все ошибки. Это удобно так как данные можно 
логгировать и не потерять в информативности.

### **Таблица результатов**
**Быстродействие** - время выполнения проверки линтером всей директории проекта. Измеряется в секундах.  
**Гибкость** - Возможность тонкой настройки конфигурации. Выделение отдельных ошибок, информативность вывода и 
проверка отдельных модулей.  
**Полезность** - ценность показаных ошибок, их уникальность обьективность.

|                    |  PyLint  | Flake8 | PyFlake |  Ruff  |
|:------------------:|:--------:|:------:|:-------:|:------:|
| Быстродействие (s) |  1.809   |  0.1   |  0.061  | 0.049  |
|      Гибкость      |   +++    |   ++   |    -    |   +    |
|     Полезность     |   +++    |   ++   |    +    |   ++   |
---

## **Итоги**
Сравнивая линтеры по трем параметрам: быстродействию, адаптивности и полезности в двух из трех случаев выделяется **PyLint**.
На деле он выделяется даже скоростью - правда как самый медленный. Такая медлительность может растянуть проверку качества
кода на очень продолжительный срок. Это не удобно.  
*PyLint* показал наибольшее количество уникальных ошибок,
прошелся по всем модулям программы и проверил всю логику. В противовес можно представить *Ruff* - самый быстрый линтер из
проверенных. Он справился с задачей быстрее всего и тоже обратил внимание на некоторые ошибки.  
*PyFlakes*, по моему мнению оказался самым бесполезным. Средний по скорости, не нашедший никаких уникальных ошибок, также
не имеет никаких особых параметров настройки. Читается неудобно.  
Однако в связке с другими линтерами, обьединенными в один и усиленный плагинами, в *Flake8*, Он работает совсем иначе.
Особенно мне понравилась кастомизация вывода и возможность оформления отчетов прямо из консоли. Да и обьяснение ошибки, 
которую не смогли обьяснить другие линтеры, радует.  
Если качество кода, который пишут программисты и так является высоким я бы выбирал для крупного проекта *Ruff*, как быстрый
и полезный линтер для опытных сотрудников. Его также можно настроить под стандарты компании. Для себя же я бы выбрал *PyLint*.
Он медленный, но куда более дотошно проверяет код. И для неопытного программиста, который допускает ошибки и пишет не особо
обьемные проекты время проверки не имеет решающего значения. В отличие от точности поиска linter. 

## **Дополнения**
Для настройки локального CI использовались Git hook - *pre-commit*, а также shell скрипт для прогона линтеров по модулям,
которые были изменены.  
Текст shell скрипт приведен ниже:  
```commandline
#!/bin/bash

way_to_log="/home/kolmilki/TestTaskAquarius/TestTaskAquarius/temp/"
way_to_project="/home/kolmilki/TestTaskAquarius/TestTaskAquarius/"
git diff --cached --name-only | grep '\.py$' | grep -v '__init__.py' > "$way_to_log"log.txt
while IFS= read -r line; do
    changed_value="$way_to_project$line"
    pylint "$changed_value"
done < "$way_to_log"log.txt
```

Функции проверки только тех строк, методов или функций которые были изменены у Linter-ов нет. Для исправления этой 
ситуации приходится писать shell скрипты и многократно обращаться к методами git. В git изменения кода отлично видны и
можно даже выяснить менялись ли какие-то определенные атрибуты или нет: ```git diff -g<regex>```.

---

# Этап 2
# Сравнение стиллистических линтеров для **Python**
На втором этапе сравним линтеры, основная задача которых форматирование. Существует множество разных стайлинговых линтеров.
Например есть pydocstyle, который проверяет только docstring, или, например, pycodestyle, замечает в коде только отклоненния
от pep8. Есть также те, который занимаются форматированием. Например black или Isort.
